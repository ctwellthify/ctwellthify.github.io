<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>70-Year Monthly Checklist (Start 20-Aug-1988)</title>
<style>
  :root{
    --bg:#0f172a; --card:#0b1220; --muted:#9aa4bf; --accent:#60a5fa;
    --card-radius:12px; --gap:12px;
  }
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; margin:0; padding:20px; background:linear-gradient(180deg,#071028 0%, #081426 100%); color:#e6eef8;}
  header{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
  h1{font-size:18px;margin:0}
  .controls{margin-left:auto; display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  button, select, input[type="number"]{background:var(--card); color:var(--muted); border:1px solid rgba(255,255,255,0.04); padding:8px 10px; border-radius:8px}
  .card{background:var(--card); padding:12px; border-radius:var(--card-radius); box-shadow:0 6px 20px rgba(2,6,23,0.6); margin-bottom:16px}
  .meta{font-size:13px;color:var(--muted)}
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:var(--gap);}
  .month{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:10px; padding:10px; border:1px solid rgba(255,255,255,0.03)}
  .month h3{margin:0 0 8px 0; font-size:14px; color:#dbeafe}
  .days{display:flex; flex-wrap:wrap; gap:6px}
  .day{display:flex; align-items:center; gap:6px; font-size:13px; color:var(--muted); background:rgba(255,255,255,0.01); padding:6px 8px; border-radius:6px}
  .pagination{display:flex; gap:8px; align-items:center; margin-top:10px}
  .small{font-size:13px;color:var(--muted)}
  a.link{color:var(--accent); text-decoration:none}
  .toolbar{display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap}
  .actions{display:flex; gap:8px}
  .exportarea{width:100%; height:120px; margin-top:8px; background:#071429; color:var(--muted); border-radius:8px; padding:8px; font-family:monospace; font-size:12px}
  footer{margin-top:18px;color:var(--muted); font-size:13px}
  @media (max-width:760px){ .grid{grid-template-columns:repeat(auto-fill,minmax(170px,1fr)); } }
</style>
</head>
<body>
<header>
  <div>
    <h1>70-Year Monthly Checklist</h1>
    <div class="meta">Range: <strong id="rangeText">20-Aug-1988 → 19-Aug-2058</strong> · 24 months per page</div>
  </div>
  <div class="controls">
    <label class="small">Months / page:
      <select id="perPageSelect">
        <option value="12">12</option>
        <option value="24" selected>24</option>
        <option value="36">36</option>
      </select>
    </label>
    <label class="small">Jump to page:
      <input id="pageInput" type="number" min="1" style="width:70px" />
    </label>
    <button id="gotoBtn">Go</button>
    <button id="prevBtn">◀ Prev</button>
    <button id="nextBtn">Next ▶</button>
  </div>
</header>

<section class="card">
  <div class="toolbar">
    <div class="actions">
      <button id="saveBtn">Save progress (local)</button>
      <button id="loadBtn">Load progress</button>
      <button id="clearBtn">Clear saved</button>
    </div>
    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
      <button id="exportBtn">Export JSON</button>
      <button id="importBtn">Import JSON</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>
  </div>
  <div style="margin-top:8px" id="status"></div>
</section>

<section id="monthsContainer" class="grid"></section>

<div class="pagination">
  <div class="small">Page <span id="pageNum">1</span> / <span id="pageCount">—</span></div>
  <div style="margin-left:auto" class="small">Showing <span id="showingRange">—</span></div>
</div>

<section class="card">
  <div class="small">Export/Imported JSON (for backup). Use <strong>Export JSON</strong> to save checked items, or paste JSON here and press <strong>Import JSON</strong>.</div>
  <textarea id="exportArea" class="exportarea" placeholder="Exported JSON appears here..."></textarea>
</section>

<footer>
  Tip: copy this file to your computer. The checklist works offline in your browser and progress is stored locally.
</footer>

<script>
(function(){
  // Config
  const start = new Date(1988, 7, 20); // months are 0-indexed: 7 = August
  const endExclusive = new Date(2058, 7, 20); // exclusive end (20 Aug 2058 not included)
  const totalMonths = (2058 - 1988) * 12 + (7 - 7); // rough months difference base; we will compute properly below
  // We'll build by iterating month by month until we reach endExclusive

  // State
  let checks = {}; // key = ISO date string 'YYYY-MM-DD' -> true
  const storageKey = '70yr_checklist_v1';
  let perPage = parseInt(document.getElementById('perPageSelect').value,10);
  let currentPage = 1;
  let monthsList = []; // array of {year,month (0..11),monthStartDate,days[]}
  const monthsContainer = document.getElementById('monthsContainer');
  const pageCountEl = document.getElementById('pageCount');
  const pageNumEl = document.getElementById('pageNum');
  const showingRangeEl = document.getElementById('showingRange');
  const exportArea = document.getElementById('exportArea');

  function pad(n){ return n<10? '0'+n : ''+n; }
  function iso(d){ return d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate()); }

  // Generate months between start (inclusive for days >= start date) and endExclusive
  function generateMonths() {
    monthsList = [];
    let cursor = new Date(start.getFullYear(), start.getMonth(), 1);
    while (cursor < endExclusive) {
      const y = cursor.getFullYear(), m = cursor.getMonth();
      // month start and end
      const monthStart = new Date(y, m, 1);
      const nextMonth = new Date(y, m+1, 1);
      const days = [];
      for (let d=1;;d++){
        const dayDate = new Date(y,m,d);
        if (dayDate >= nextMonth) break;
        // Include only if within [start, endExclusive)
        if (dayDate >= start && dayDate < endExclusive) days.push(new Date(dayDate));
      }
      monthsList.push({year:y, month:m, monthStart, days});
      cursor = nextMonth;
    }
  }

  function renderPage(page=1){
    perPage = parseInt(document.getElementById('perPageSelect').value,10);
    const total = monthsList.length;
    const pages = Math.ceil(total / perPage) || 1;
    if (page < 1) page = 1;
    if (page > pages) page = pages;
    currentPage = page;
    pageNumEl.textContent = currentPage;
    pageCountEl.textContent = pages;

    // determine slice
    const startIdx = (currentPage - 1) * perPage;
    const endIdx = Math.min(startIdx + perPage, total);
    monthsContainer.innerHTML = '';
    const fragment = document.createDocumentFragment();

    for (let i = startIdx; i < endIdx; i++){
      const m = monthsList[i];
      const el = document.createElement('div');
      el.className = 'month';
      const monthName = m.monthStart.toLocaleString(undefined, {month:'long', year:'numeric'});
      el.innerHTML = `<h3>${monthName}</h3><div class="days" id="month-${i}"></div>`;
      fragment.appendChild(el);

      // build days checkboxes
      const daysDiv = el.querySelector(`#month-${i}`);
      m.days.forEach(dayDate => {
        const id = 'chk-' + iso(dayDate);
        const checked = !!checks[iso(dayDate)];
        const dayEl = document.createElement('label');
        dayEl.className = 'day';
        dayEl.innerHTML = `<input type="checkbox" id="${id}" data-date="${iso(dayDate)}" ${checked ? 'checked' : ''} /> ${dayDate.getDate()}`;
        daysDiv.appendChild(dayEl);
      });
    }

    monthsContainer.appendChild(fragment);
    // update showing range
    showingRangeEl.textContent = `${startIdx+1}–${endIdx} of ${monthsList.length} months`;
    // attach listeners to checkboxes
    Array.from(monthsContainer.querySelectorAll('input[type=checkbox]')).forEach(chk=>{
      chk.addEventListener('change', (e)=>{
        const d = e.target.dataset.date;
        if (e.target.checked) checks[d]=true; else delete checks[d];
      });
    });

    // update page input
    document.getElementById('pageInput').value = currentPage;
    updateStatus();
  }

  function updateStatus(){
    const checkedCount = Object.keys(checks).length;
    document.getElementById('status').innerHTML = `<span class="small">Checked days: <strong>${checkedCount}</strong></span>`;
  }

  // Save/load
  function saveToLocal(){
    const payload = { savedAt: new Date().toISOString(), checks };
    localStorage.setItem(storageKey, JSON.stringify(payload));
    alert('Progress saved locally.');
  }
  function loadFromLocal(){
    const raw = localStorage.getItem(storageKey);
    if (!raw){ alert('No saved data found.'); return; }
    try{
      const obj = JSON.parse(raw);
      checks = obj.checks || {};
      renderPage(currentPage);
      alert('Progress loaded.');
    }catch(e){ alert('Failed to load saved data: '+e.message); }
  }
  function clearSaved(){
    localStorage.removeItem(storageKey);
    checks = {};
    renderPage(1);
    alert('Saved data cleared.');
  }

  // Export/Import JSON
  function exportJSON(){
    const payload = { exportedAt: new Date().toISOString(), start: iso(start), endExclusive: iso(endExclusive), checks };
    const text = JSON.stringify(payload, null, 2);
    exportArea.value = text;
    // also offer file download
    const blob = new Blob([text], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '70yr_checklist_export.json';
    a.click();
    URL.revokeObjectURL(url);
  }
  function importJSONFromArea(){
    const txt = exportArea.value.trim();
    if (!txt) { alert('Paste JSON into the textarea first, or use Import File'); return; }
    try{
      const obj = JSON.parse(txt);
      if (!obj.checks) throw new Error('JSON missing checks object');
      checks = obj.checks;
      renderPage(currentPage);
      alert('Imported from textarea.');
    }catch(e){ alert('Import failed: '+e.message); }
  }
  function importJSONFromFile(file){
    const reader = new FileReader();
    reader.onload = function(){ 
      try{
        const obj = JSON.parse(reader.result);
        if (!obj.checks) throw new Error('JSON missing checks object');
        checks = obj.checks;
        renderPage(1);
        exportArea.value = JSON.stringify(obj,null,2);
        alert('Imported from file.');
      }catch(e){ alert('Import failed: '+e.message); }
    };
    reader.readAsText(file);
  }

  // Wire events
  document.getElementById('perPageSelect').addEventListener('change', ()=>{
    perPage = parseInt(document.getElementById('perPageSelect').value,10);
    renderPage(1);
  });
  document.getElementById('prevBtn').addEventListener('click', ()=> renderPage(currentPage-1));
  document.getElementById('nextBtn').addEventListener('click', ()=> renderPage(currentPage+1));
  document.getElementById('gotoBtn').addEventListener('click', ()=>{
    const v = parseInt(document.getElementById('pageInput').value,10) || 1;
    renderPage(v);
  });
  document.getElementById('saveBtn').addEventListener('click', saveToLocal);
  document.getElementById('loadBtn').addEventListener('click', loadFromLocal);
  document.getElementById('clearBtn').addEventListener('click', ()=>{
    if (confirm('Clear saved progress? This will NOT clear current in-memory checks unless you choose to.')) clearSaved();
  });
  document.getElementById('exportBtn').addEventListener('click', exportJSON);
  document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importFile').click());
  document.getElementById('importFile').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if (f) importJSONFromFile(f);
    e.target.value = '';
  });
  // allow import from textarea
  document.addEventListener('keydown', (e)=>{
    if ((e.ctrlKey || e.metaKey) && e.key === 'i'){ e.preventDefault(); importJSONFromArea(); }
    if ((e.ctrlKey || e.metaKey) && e.key === 's'){ e.preventDefault(); saveToLocal(); }
  });

  // Initialize
  generateMonths();
  // compute final range text (display friendly)
  const startStr = start.toLocaleDateString(undefined,{day:'2-digit', month:'short', year:'numeric'});
  const endStr = new Date(endExclusive.getFullYear(), endExclusive.getMonth(), endExclusive.getDate()-1)
                   .toLocaleDateString(undefined,{day:'2-digit', month:'short', year:'numeric'});
  document.getElementById('rangeText').textContent = `${startStr} → ${endStr}`;
  // set page input max
  perPage = parseInt(document.getElementById('perPageSelect').value,10);
  renderPage(1);

  // Try to auto-load stored progress silently if present
  try{
    const raw = localStorage.getItem(storageKey);
    if (raw){
      const obj = JSON.parse(raw);
      checks = obj.checks || {};
      // do not alert — just reflect
      renderPage(1);
    }
  }catch(e){}
})();
</script>
</body>
</html>
